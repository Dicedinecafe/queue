<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice & Dine</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

      <link rel="stylesheet" href="/static/queue.css" />
    
</head>
<body>
    <div class="left-panel">
        <div class="logo">
        <svg width="522" height="58" viewBox="0 0 522 58" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M110.336 5.63726C106.84 2.1544 102.006 0 96.6657 0H77.3325L57.9994 19.2453C57.9994 13.9288 55.8352 9.11744 52.3364 5.63726C48.8403 2.1544 44.007 0 38.6663 0H19.3331L0 19.2453V57.7358H38.6663L57.9994 38.4905V57.7358H96.6657L115.999 38.4905V19.2453C115.999 13.9288 113.835 9.11744 110.336 5.63726ZM28.9997 38.4905C23.6616 38.4905 19.3331 34.1817 19.3331 28.8679C19.3331 23.5541 23.6616 19.2453 28.9997 19.2453C34.3378 19.2453 38.6663 23.5541 38.6663 28.8679C38.6663 34.1817 34.3378 38.4905 28.9997 38.4905ZM86.9991 38.4905C81.661 38.4905 77.3325 34.1817 77.3325 28.8679C77.3325 23.5541 81.661 19.2453 86.9991 19.2453C92.3372 19.2453 96.6657 23.5541 96.6657 28.8679C96.6657 34.1817 92.3372 38.4905 86.9991 38.4905Z" fill="#00E6AA"/>
<path d="M180.359 8.10835C177.599 5.52361 174.372 3.53761 170.682 2.14767C166.99 0.76041 162.96 0.0681152 158.588 0.0681152H135.378V57.7023H158.752C163.07 57.7023 167.076 56.994 170.765 55.58C174.457 54.166 177.666 52.1773 180.4 49.6193C183.133 47.0613 185.252 44.0141 186.758 40.4778C188.259 36.9388 189.014 33.0764 189.014 28.8852C189.014 24.694 188.259 20.7621 186.758 17.2525C185.254 13.7429 183.12 10.6958 180.359 8.11103V8.10835ZM173.676 38.2726C172.256 40.9402 170.231 42.9663 167.608 44.3563C164.982 45.7435 161.92 46.4385 158.422 46.4385H148.253V11.2517H158.422C161.923 11.2517 164.968 11.9601 167.565 13.3741C170.161 14.7881 172.186 16.8035 173.636 19.4176C175.083 22.0291 175.808 25.1591 175.808 28.805C175.808 32.4509 175.097 35.6077 173.676 38.2726Z" fill="#FFF0D9"/>
<path d="M201.282 0.898193C199.384 0.898193 197.811 1.52901 196.573 2.78797C195.332 4.04693 194.715 5.62397 194.715 7.51375C194.715 9.40353 195.335 10.9164 196.573 12.2021C197.813 13.4878 199.384 14.132 201.282 14.132C203.181 14.132 204.738 13.4878 205.952 12.2021C207.166 10.9164 207.773 9.35274 207.773 7.51375C207.773 5.67476 207.163 4.04693 205.952 2.78797C204.736 1.52634 203.181 0.898193 201.282 0.898193Z" fill="#FFF0D9"/>
<path d="M207.3 19.4136H195.189V57.7063H207.3V19.4136Z" fill="#FFF0D9"/>
<path d="M239.004 45.9267C237.763 46.4773 236.351 46.7527 234.769 46.7527C233.08 46.7527 231.55 46.3597 230.177 45.5712C228.808 44.7827 227.737 43.7082 226.971 42.3396C226.206 40.9764 225.822 39.3967 225.822 37.6112C225.822 35.8256 226.206 34.2619 226.971 32.9255C227.737 31.5863 228.792 30.5359 230.14 29.7714C231.485 29.0096 233.029 28.6274 234.769 28.6274C236.297 28.6274 237.658 28.8653 238.843 29.3384C240.032 29.8115 241.071 30.5492 241.971 31.5436L249.728 23.8241C247.776 21.7739 245.545 20.237 243.039 19.2132C240.534 18.1895 237.777 17.679 234.769 17.679C230.76 17.679 227.143 18.545 223.924 20.2797C220.704 22.0118 218.159 24.3881 216.287 27.4085C214.413 30.4316 213.476 33.8557 213.476 37.6913C213.476 41.527 214.4 44.8869 216.247 47.9341C218.092 50.9813 220.626 53.3709 223.846 55.103C227.065 56.835 230.65 57.7037 234.611 57.7037C237.723 57.7037 240.548 57.1638 243.08 56.0893C245.614 55.0121 247.881 53.4243 249.887 51.3234L242.21 43.6012C241.31 44.6009 240.244 45.3734 239.004 45.9267Z" fill="#FFF0D9"/>
<path d="M286.3 20.122C283.397 18.4942 280.046 17.679 276.249 17.679C272.452 17.679 268.835 18.545 265.72 20.2797C262.606 22.0118 260.141 24.3881 258.32 27.4085C256.5 30.4316 255.589 33.8557 255.589 37.6913C255.589 41.527 256.513 44.9671 258.36 48.0143C260.205 51.0615 262.751 53.4377 265.997 55.143C269.243 56.8484 272.949 57.7037 277.119 57.7037C280.338 57.7037 283.295 57.1504 285.985 56.0492C288.676 54.9453 290.972 53.2934 292.87 51.0855L286.224 44.4699C285.062 45.785 283.716 46.766 282.189 47.4236C280.658 48.0811 278.942 48.4099 277.044 48.4099C274.987 48.4099 273.204 47.9769 271.7 47.1108C270.197 46.2448 269.034 45.0126 268.218 43.4061C267.944 42.8742 267.721 42.3022 267.541 41.7008L286.216 41.6553L295.091 41.6339C295.3 40.6369 295.445 39.7575 295.526 38.9957C295.604 38.234 295.644 37.5123 295.644 36.828C295.644 33.0992 294.811 29.7901 293.152 26.9006C291.49 24.0139 289.208 21.7552 286.305 20.1274L286.3 20.122ZM267.541 33.4226C267.702 32.8693 267.898 32.3454 268.134 31.8616C268.9 30.2873 269.979 29.0657 271.381 28.197C272.777 27.331 274.428 26.898 276.327 26.898C278.121 26.898 279.638 27.2802 280.878 28.042C282.116 28.8065 283.053 29.9077 283.69 31.3538C283.955 31.9605 284.165 32.6368 284.329 33.3772L267.544 33.4253L267.541 33.4226Z" fill="#FFF0D9"/>
<path d="M319.579 19.0981C319.074 18.2 318.825 17.1736 318.825 16.0109C318.825 14.6423 319.34 13.493 320.374 12.5681C321.408 11.6459 322.718 11.1862 324.305 11.1862C325.892 11.1862 327.181 11.5551 328.319 12.2955C329.458 13.0332 330.556 14.1131 331.617 15.5378L339.726 7.86372C338.928 6.54595 337.79 5.29234 336.305 4.10555C334.823 2.91609 333.072 1.94313 331.061 1.17867C329.047 0.414202 326.743 0.0292969 324.147 0.0292969C320.809 0.0292969 317.879 0.75634 315.363 2.20508C312.847 3.65382 310.86 5.58102 309.402 7.98133C307.944 10.3816 307.217 13.0038 307.217 15.8532C307.217 18.2268 307.668 20.4025 308.567 22.3778C309.045 23.431 309.687 24.5162 310.479 25.6362C307.743 27.1624 305.624 29.0335 304.113 31.2414C302.26 33.9597 301.331 37.0577 301.331 40.5352C301.331 43.7534 302.115 46.6696 303.678 49.2784C305.238 51.8899 307.44 53.9481 310.272 55.453C313.105 56.9552 316.432 57.7062 320.245 57.7062C322.683 57.7062 324.974 57.3614 327.119 56.6772C329.265 55.9902 331.171 55.1081 332.841 54.0256C333.572 53.5552 334.219 53.074 334.801 52.5902L339.549 57.6982H353.775L321.751 22.1052C320.798 20.9959 320.071 19.9962 319.566 19.0981H319.579ZM325.223 45.4828C323.924 46.25 322.374 46.6322 320.575 46.6322C318.986 46.6322 317.606 46.3409 316.443 45.7608C315.275 45.1808 314.389 44.3762 313.782 43.3472C313.17 42.3181 312.866 41.1206 312.866 39.7467C312.866 38.0601 313.264 36.6086 314.058 35.3951C314.708 34.4035 315.629 33.5748 316.811 32.8986L327.044 44.0902C326.488 44.6328 325.881 45.0979 325.226 45.4828H325.223Z" fill="#FFF0D9"/>
<path d="M404.498 8.08318C401.735 5.49844 398.507 3.50976 394.815 2.11983C391.123 0.732565 387.09 0.0375977 382.713 0.0375977H359.492V57.7039H382.88C387.197 57.7039 391.206 56.9955 394.898 55.5815C398.593 54.1675 401.802 52.1762 404.538 49.6182C407.274 47.0575 409.393 44.0076 410.899 40.4687C412.403 36.9297 413.155 33.0646 413.155 28.8707C413.155 24.6769 412.403 20.745 410.899 17.2327C409.396 13.7204 407.261 10.6733 404.501 8.08585L404.498 8.08318ZM397.812 38.2635C396.389 40.9338 394.364 42.9599 391.738 44.3498C389.112 45.737 386.048 46.432 382.549 46.432H372.375V11.2292H382.549C386.051 11.2292 389.098 11.9376 391.698 13.3516C394.294 14.7682 396.319 16.7836 397.772 19.3978C399.219 22.0119 399.944 25.1446 399.944 28.7905C399.944 32.4364 399.232 35.5959 397.812 38.2635Z" fill="#FFF0D9"/>
<path d="M519.5 26.8975C517.84 24.0107 515.558 21.7521 512.655 20.1242C509.753 18.4964 506.402 17.6812 502.602 17.6812C498.803 17.6812 495.189 18.5472 492.076 20.2819C488.962 22.014 486.494 24.3903 484.676 27.4107C482.856 30.4338 481.945 33.8579 481.945 37.6935C481.945 41.5292 482.869 44.9693 484.716 48.0165C486.561 51.0637 489.107 53.4399 492.353 55.1452C495.599 56.8506 499.305 57.7059 503.475 57.7059C506.694 57.7059 509.651 57.1526 512.341 56.0514C515.032 54.9474 517.328 53.2956 519.226 51.0877L512.58 44.4722C511.418 45.7872 510.072 46.7682 508.545 47.4258C507.014 48.0833 505.298 48.4121 503.4 48.4121C501.34 48.4121 499.557 47.9791 498.056 47.113C496.553 46.247 495.39 45.0148 494.571 43.4083C494.3 42.8764 494.077 42.3044 493.897 41.703L512.572 41.6575L521.444 41.6362C521.656 40.6391 521.801 39.7597 521.882 38.9979C521.96 38.2362 522 37.5145 522 36.8302C522 33.1014 521.167 29.7923 519.505 26.9028L519.5 26.8975ZM493.894 33.4222C494.058 32.8689 494.254 32.345 494.49 31.8612C495.256 30.2868 496.335 29.0653 497.737 28.1965C499.133 27.3305 500.784 26.8975 502.683 26.8975C504.474 26.8975 505.994 27.2797 507.234 28.0415C508.475 28.806 509.409 29.9072 510.043 31.3533C510.309 31.9601 510.521 32.6363 510.685 33.3767L493.897 33.4248L493.894 33.4222Z" fill="#FFF0D9"/>
<path d="M425.426 0.898193C423.527 0.898193 421.954 1.52901 420.716 2.78797C419.475 4.04693 418.858 5.62397 418.858 7.51375C418.858 9.40353 419.478 10.9164 420.716 12.2021C421.954 13.4878 423.527 14.132 425.426 14.132C427.324 14.132 428.881 13.4878 430.095 12.2021C431.309 10.9164 431.916 9.35274 431.916 7.51375C431.916 5.67476 431.306 4.04693 430.095 2.78797C428.879 1.52634 427.324 0.898193 425.426 0.898193Z" fill="#FFF0D9"/>
<path d="M431.44 19.4136H419.33V57.7063H431.44V19.4136Z" fill="#FFF0D9"/>
<path d="M456.931 18.625C446.265 18.625 437.619 27.2346 437.619 37.8489V57.7036H449.689V37.8489C449.689 33.8742 452.94 30.6399 456.931 30.6399C460.921 30.6399 464.172 33.8742 464.172 37.8489V57.7036H476.242V37.8489C476.242 27.2319 467.596 18.625 456.931 18.625Z" fill="#FFF0D9"/>
</svg>

        </div>
        
        <div class="player-container">
            <div class="player-content">
                <div class="album-art-container">
                    <img id="album-art" src="https://via.placeholder.com/280x280/87CEEB/FFFFFF?text=No+Track" alt="Album Art" />
                </div>
                
                <div class="track-info">
                    <h2 id="track-name">No Track Playing</h2>
                    <div id="artist-name" class="artist">Select a song</div>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar">
                    <div id="progress-bar-fill"></div>
                    <div id="progress-bar-circle"></div>
                </div>
                <div class="time-info">
                    <span id="time-stamp">0:00 / 0:00</span>
                    <span></span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="right-panel">
        <div class="queue-section">
            <h1>JOIN<br>THE<br>QUEUE</h1>
            
          <div class="qrcode">
    <div id="qrcode"></div>

  </div>
            </div>
        </div>
    </div>

    
    <script>
        const timeStamp = document.getElementById('time-stamp');
        const progressFill = document.getElementById('progress-bar-fill');
        const progressCircle = document.getElementById('progress-bar-circle');
        const progressBar = document.getElementById('progress-bar');
        let songProgress = 0;
        let songDuration = 0;
        let isPlaying = false;

        // Make progress bar interactive
        progressBar.addEventListener('click', (e) => {
            const rect = progressBar.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const progressPercent = (clickX / rect.width) * 100;
            
            progressFill.style.width = `${Math.max(0, Math.min(100, progressPercent))}%`;
            progressCircle.style.left = `${Math.max(0, Math.min(100, progressPercent))}%`;
            
            if (songDuration > 0) {
                songProgress = (progressPercent / 100) * songDuration;
                timeStamp.textContent = `${formatTime(songProgress)} / ${formatTime(songDuration)}`;
            }
        });

        async function fetchCurrentTrack() {
            try {
                const res = await fetch('/current');
                const data = await res.json();

                const albumArt = document.getElementById('album-art');
                const trackName = document.getElementById('track-name');
                const artistName = document.getElementById('artist-name');

                if (data.message) {
                    trackName.textContent = data.message;
                    albumArt.style.display = 'none';
                    artistName.textContent = '';
                    timeStamp.textContent = '';
                    isPlaying = false;
                    return;
                }

                albumArt.src = data.image || 'https://via.placeholder.com/280x280/87CEEB/FFFFFF?text=No+Image';
                albumArt.style.display = 'block';
                trackName.textContent = data.name;
                artistName.textContent = data.artist;

                songProgress = data.progress_ms || 0;
                songDuration = data.duration_ms || 0;
                isPlaying = data.is_playing;
            } catch (err) {
                console.error('Error fetching current track:', err);
                // Fallback for demo purposes
                const albumArt = document.getElementById('album-art');
                const trackName = document.getElementById('track-name');
                const artistName = document.getElementById('artist-name');
                
                albumArt.src = 'https://via.placeholder.com/280x280/87CEEB/FFFFFF?text=Remedy';
                trackName.textContent = 'Remedy';
                artistName.textContent = 'Annie Schindel';
                songProgress = 106000; // 1:46
                songDuration = 220000; // 3:40
                isPlaying = true;
            }
        }

        async function fetchQueue() {
            try {
                const res = await fetch('/queue-spotify');
                const data = await res.json();

                const queueCircles = document.getElementById('queue-circles');

                if (!data.queue || data.queue.length === 0) {
                    return;
                }

                const emptyMessage = queueCircles.querySelector('.empty-queue');
                if (emptyMessage) {
                    queueCircles.removeChild(emptyMessage);
                }

                const limitedQueue = data.queue.slice(0, 4);
                while (queueCircles.children.length > limitedQueue.length) {
                    queueCircles.removeChild(queueCircles.lastChild);
                }

                limitedQueue.forEach((track, index) => {
                    let queueItem = queueCircles.children[index];
                    if (!queueItem) {
                        queueItem = document.createElement('div');
                        queueItem.className = 'queue-wrapper';
                        queueItem.setAttribute('data-id', track.id);
                        queueItem.innerHTML = `
                            <div class="queue-item">
                                <img src="${track.image}" alt="${track.name}" class="queue-image spinning" />
                            </div>
                            <div class="queue-text">
                                <p class="track-title">${track.name}</p>
                                <p class="track-artist">${track.artist}</p>
                            </div>
                        `;
                        queueCircles.appendChild(queueItem);
                    } else {
                        const currentId = queueItem.getAttribute('data-id');
                        if (currentId !== track.id) {
                            queueItem.setAttribute('data-id', track.id);
                            const img = queueItem.querySelector('img');
                            img.src = track.image;
                            img.alt = track.name;
                            queueItem.querySelector('.track-title').textContent = track.name;
                            queueItem.querySelector('.track-artist').textContent = track.artist;
                        }
                    }
                });
            } catch (err) {
                console.error("Error fetching queue:", err);
            }
        }

        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        setInterval(() => {
            if (!isPlaying || songDuration === 0) return;

            songProgress += 1000;
            if (songProgress > songDuration) songProgress = songDuration;

            timeStamp.textContent = `${formatTime(songProgress)} / ${formatTime(songDuration)}`;

            const progressPercent = (songProgress / songDuration) * 100;
            progressFill.style.width = `${progressPercent}%`;
            progressCircle.style.left = `${progressPercent}%`;
        }, 1000);

     
        const container = document.getElementById("qrcode");
    if (container) {
      new QRCode(container, {
        text: "https://music.dicedinecafe.com",
        width: 250,
        height: 250,
        colorDark: "#000000",
        colorLight: "#fbeee0",
        correctLevel: QRCode.CorrectLevel.H
      });
    } else {
      alert("QR container not found!");
    }
      

        document.addEventListener('DOMContentLoaded', () => {
            fetchCurrentTrack();
            fetchQueue();
            generateQR();
            addBackgroundIcons();

            const TRACK_REFRESH = 5000;
            const QUEUE_REFRESH = 5000;

            setInterval(fetchCurrentTrack, TRACK_REFRESH);
            setInterval(fetchQueue, QUEUE_REFRESH);
        });

    
    </script>
</body>
</html>